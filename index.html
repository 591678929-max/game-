<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Ç—Ä–∏—Å</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto Mono', 'Press Start 2P', monospace, sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #1a1a1a;
            padding: 20px;
            overflow: hidden;
            color: #fff;
        }

        h1 {
            font-family: 'Press Start 2P', monospace;
            font-size: 48px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 25px;
            letter-spacing: 4px;
            text-shadow: 0 0 10px #ffff00, 0 0 20px #ffff00;
            text-align: center;
        }

        .game-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            background-color: #2d2d2d;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.8s ease;
            border: 2px solid #444;
        }

        #gameCanvas {
            border: 3px solid #ffffff;
            background-color: #000;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(255,255,255,0.1);
        }

        .next-container {
            background-color: #000;
            border: 3px solid #fff;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .next-title {
            font-family: 'Press Start 2P', monospace;
            font-size: 16px;
            color: #ffcc00;
            margin-bottom: 10px;
        }
        #nextCanvas {
            background-color: #111;
            border: 1px solid #444;
        }

        .game-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 25px;
            background-color: #333;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
            min-width: 240px;
            border: 1px solid #444;
        }

        .score-box {
            font-size: 24px;
            color: #ffffff;
            font-weight: 700;
            padding-bottom: 15px;
            border-bottom: 2px solid #444;
            text-align: center;
        }

        .score-box span {
            color: #ffcc00;
            font-family: 'Press Start 2P', monospace;
            letter-spacing: 2px;
        }

        .control-info {
            font-size: 15px;
            color: #cccccc;
            line-height: 1.8;
        }

        .control-info p:first-child {
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 17px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            color: #000;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Press Start 2P', monospace;
            text-transform: uppercase;
            box-shadow: 0 4px 0 0 #222;
            white-space: nowrap;
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 0 #222;
        }

        .start-btn {
            background-color: #4cd964;
        }
        .start-btn:hover {
            background-color: #34c84a;
            box-shadow: 0 4px 0 0 #222, 0 0 10px rgba(76,217,100,0.5);
        }

        .pause-btn {
            background-color: #ff9500;
        }
        .pause-btn:hover {
            background-color: #e08600;
            box-shadow: 0 4px 0 0 #222, 0 0 10px rgba(255,149,0,0.5);
        }

        .lang-btn {
            background-color: #ff2d55;
        }
        .lang-btn:hover {
            background-color: #e21d40;
            box-shadow: 0 4px 0 0 #222, 0 0 10px rgba(255,45,85,0.5);
        }

        .resume-btn {
            background-color: #4cd964;
            margin-right: 10px;
        }
        .resume-btn:hover {
            background-color: #34c84a;
            box-shadow: 0 4px 0 0 #222, 0 0 10px rgba(76,217,100,0.5);
        }

        .home-btn {
            background-color: #ff3b30;
        }
        .home-btn:hover {
            background-color: #e63025;
            box-shadow: 0 4px 0 0 #222, 0 0 10px rgba(255,59,48,0.5);
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #ff3b30;
            font-weight: 700;
            display: none;
            text-shadow: 0 0 15px #ff3b30, 2px 2px 0 #000;
            font-family: 'Press Start 2P', monospace;
        }

        .pause-mask {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
        }

        .pause-text {
            font-size: 40px;
            color: #ffffff;
            font-family: 'Press Start 2P', monospace;
            text-shadow: 0 0 10px #ffffff;
            margin-bottom: 30px;
        }

        .pause-buttons {
            display: flex;
            gap: 15px;
        }

        .canvas-wrapper {
            position: relative;
        }

        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: pointer;
        }

        .splash-title {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Press Start 2P', monospace;
            font-size: 64px;
            color: #ffffff;
            text-shadow: 0 0 15px #ffff00, 0 0 30px #ffff00, 2px 2px 0 #000;
            letter-spacing: 8px;
            z-index: 100;
            pointer-events: none;
        }

        .block-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(30px, 30px));
            width: 100%;
            height: 100%;
        }

        .splash-block {
            width: 100%;
            height: 100%;
            transition: all 0.4s ease;
        }

        .splash-block.center-block {
            background: #ffffff !important;
            border: 4px solid #ffffff;
            box-shadow: 0 0 25px #ffffff, 0 0 50px rgba(255,255,255,0.7);
            animation: pulse-shake 1.2s infinite ease-in-out;
            z-index: 100 !important;
            position: relative;
        }

        @keyframes pulse-shake {
            0% { transform: scale(1); }
            25% { transform: scale(1.15) translate(-1px, 1px); }
            50% { transform: scale(1.1); }
            75% { transform: scale(1.15) translate(1px, -1px); }
            100% { transform: scale(1); }
        }

        .splash-block.collapse {
            transform: scale(0) rotate(45deg);
            opacity: 0;
        }
    </style>
</head>
<body>

<!-- ÂºÄÂú∫ -->
<div class="splash-screen" id="splashScreen">
    <div class="splash-title" id="splashTitle">–¢–ï–¢–†–ò–°</div>
    <div class="block-grid" id="blockGrid"></div>
</div>

<h1 id="mainTitle">–¢–ï–¢–†–ò–°</h1>
<div class="game-container" id="gameContainer">
    <div class="canvas-wrapper">
        <canvas id="gameCanvas" width="300" height="600"></canvas>
        <div class="pause-mask" id="pauseMask">
            <div class="pause-content">
                <div class="pause-text" id="pauseText">–ü–ê–£–ó–ê</div>
                <div class="pause-buttons">
                    <button class="btn resume-btn" id="resumeBtn">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
                    <button class="btn home-btn" id="homeBtn">–î–û–ú–û–ô</button>
                </div>
            </div>
        </div>
    </div>

    <div class="game-info">
        <div class="next-container">
            <div class="next-title" id="nextTitle">NEXT</div>
            <canvas id="nextCanvas" width="120" height="120"></canvas>
        </div>

        <div class="score-box" id="scoreBox">–°–ß–Å–¢: <span id="score">0</span></div>

        <button class="btn start-btn" id="startBtn">–°–¢–ê–†–¢</button>
        <button class="btn pause-btn" id="pauseBtn" disabled>–ü–ê–£–ó–ê</button>
        <button class="btn lang-btn" id="langBtn">–Ø–ó–´–ö: –†–£–°</button>

        <div class="control-info" id="controlInfo">
            <p id="controlTitle">üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï:</p>
            <p id="controlLine1">‚Üê –í–õ–ï–í–û | ‚Üí –í–ü–†–ê–í–û | ‚Üì –£–°–ö–û–†–ò–¢–¨</p>
            <p id="controlLine2">‚Üë –ü–û–í–ï–†–ù–£–¢–¨ | –ü–†–û–ë–ï–õ –ü–†–Ø–ú–û –í–ù–ò–ó | ESC –ü–ê–£–ó–ê</p>
        </div>
    </div>
</div>

<div class="game-over" id="gameOverText">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!</div>

<script>
    let score = 0;
    let isPaused = false;
    let isGameOver = false;

    let lastTime = 0;
    let dropTimer = 0;
    const DROP_SPEED = 800;

    let nextShape = null;
    let nextColor = null;

    const langData = [
        {
            code: 'ru', 
            btnText: '–Ø–ó–´–ö: –†–£–°',
            splashTitle: '–¢–ï–¢–†–ò–°', 
            mainTitle: '–¢–ï–¢–†–ò–°',
            score: '–°–ß–Å–¢', 
            start: '–°–¢–ê–†–¢', 
            pause: '–ü–ê–£–ó–ê', 
            continueText: '–ü–†–û–î–û–õ–ñ–ò–¢–¨',
            gameOver: '–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!', 
            pauseTip: '–ü–ê–£–ó–ê', 
            next: '–î–ê–õ–¨–®–ï',
            home: '–î–û–ú–û–ô',
            controlTitle: 'üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï:', 
            control1: '‚Üê –í–õ–ï–í–û | ‚Üí –í–ü–†–ê–í–û | ‚Üì –£–°–ö–û–†–ò–¢–¨', 
            control2: '‚Üë –ü–û–í–ï–†–ù–£–¢–¨ | –ü–†–û–ë–ï–õ –ü–†–Ø–ú–û –í–ù–ò–ó | ESC –ü–ê–£–ó–ê'
        },
        {
            code: 'en', 
            btnText: 'LANG: EN',
            splashTitle: 'TETRIS', 
            mainTitle: 'TETRIS',
            score: 'SCORE', 
            start: 'START', 
            pause: 'PAUSE', 
            continueText: 'CONTINUE',
            gameOver: 'GAME OVER!', 
            pauseTip: 'PAUSED', 
            next: 'NEXT',
            home: 'HOME',
            controlTitle: 'üéÆ CONTROLS:', 
            control1: '‚Üê LEFT | ‚Üí RIGHT | ‚Üì DOWN', 
            control2: '‚Üë ROTATE | SPACE DROP | ESC PAUSE'
        },
        {
            code: 'cn', 
            btnText: 'ËØ≠Ë®Ä: ‰∏≠Êñá',
            splashTitle: '‰øÑÁΩóÊñØÊñπÂùó', 
            mainTitle: '‰øÑÁΩóÊñØÊñπÂùó',
            score: 'ÂàÜÊï∞', 
            start: 'ÂºÄÂßã', 
            pause: 'ÊöÇÂÅú', 
            continueText: 'ÁªßÁª≠',
            gameOver: 'Ê∏∏ÊàèÁªìÊùü!', 
            pauseTip: 'Â∑≤ÊöÇÂÅú', 
            next: '‰∏ã‰∏Ä‰∏™',
            home: 'ÂõûÂà∞‰∏ªÈ°µ',
            controlTitle: 'üéÆ Êìç‰Ωú:', 
            control1: '‚Üê Â∑¶ | ‚Üí Âè≥ | ‚Üì Âä†ÈÄü', 
            control2: '‚Üë ÊóãËΩ¨ | Á©∫Ê†º ÊûÅÈÄü‰∏ãËêΩ | ESC ÊöÇÂÅú'
        }
    ];

    let langIndex = 0;
    let currentLang = langData[langIndex];

    // DOMÂÖÉÁ¥†
    const splashScreen = document.getElementById('splashScreen');
    const blockGrid = document.getElementById('blockGrid');
    const gameContainer = document.getElementById('gameContainer');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const nextCanvas = document.getElementById('nextCanvas');
    const nextCtx = nextCanvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const langBtn = document.getElementById('langBtn');
    const gameOverText = document.getElementById('gameOverText');
    const pauseMask = document.getElementById('pauseMask');
    const resumeBtn = document.getElementById('resumeBtn');
    const homeBtn = document.getElementById('homeBtn');

    // Â∏∏ÈáèÂÆö‰πâ
    const BLOCK_COLORS = ['#00ffff','#ffff00','#9966cc','#ff9500','#0066ff','#00cc66','#ff3333','#2c3e50'];
    const BLOCK_SIZE = 30;
    const GRID_COLS = Math.ceil(window.innerWidth / BLOCK_SIZE);
    const GRID_ROWS = Math.ceil(window.innerHeight / BLOCK_SIZE);
    const CENTER_COL = Math.floor(GRID_COLS/2);
    const CENTER_ROW = Math.floor(GRID_ROWS/2);
    const GAME_BLOCK_SIZE=30, COLS=10, ROWS=20;
    const SHAPES = [
        [[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],
        [[0,0,1],[1,1,1]],[[1,0,0],[1,1,1]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]]
    ];
    const COLORS = ['#00ffff','#ffff00','#9966cc','#ff9500','#0066ff','#00cc66','#ff3333'];

    // Ê∏∏ÊàèÂèòÈáè
    let gameBoard = [], currentShape, currentColor, currentX, currentY;
    let gameInterval;
    let clearingRows=[], clearAnimationTime=0, ANIM_DURATION=300;

    // ÂàáÊç¢ËØ≠Ë®Ä
    function switchLanguage() {
        langIndex = (langIndex + 1) % 3;
        currentLang = langData[langIndex];
        
        document.getElementById('langBtn').textContent = currentLang.btnText;
        document.getElementById('splashTitle').textContent = currentLang.splashTitle;
        document.getElementById('mainTitle').textContent = currentLang.mainTitle;
        document.getElementById('scoreBox').innerHTML = `${currentLang.score}: <span id="score">${score}</span>`;
        document.getElementById('startBtn').textContent = currentLang.start;
        document.getElementById('gameOverText').textContent = currentLang.gameOver;
        document.getElementById('pauseText').textContent = currentLang.pauseTip;
        document.getElementById('nextTitle').textContent = currentLang.next;
        document.getElementById('controlTitle').textContent = currentLang.controlTitle;
        document.getElementById('controlLine1').textContent = currentLang.control1;
        document.getElementById('controlLine2').textContent = currentLang.control2;
        document.getElementById('resumeBtn').textContent = currentLang.continueText;
        document.getElementById('homeBtn').textContent = currentLang.home;
        
        if (!isPaused) {
            document.getElementById('pauseBtn').textContent = currentLang.pause;
        } else {
            document.getElementById('pauseBtn').textContent = currentLang.continueText;
        }
    }

    // ÂºÄÂú∫Âä®Áîª
    function createSplashGrid() {
        blockGrid.style.gridTemplateColumns = `repeat(${GRID_COLS}, ${BLOCK_SIZE}px)`;
        blockGrid.style.gridTemplateRows = `repeat(${GRID_ROWS}, ${BLOCK_SIZE}px)`;
        for(let r=0;r<GRID_ROWS;r++){
            for(let c=0;c<GRID_COLS;c++){
                const b = document.createElement('div');
                b.classList.add('splash-block');
                b.dataset.row=r; b.dataset.col=c;
                if(r===CENTER_ROW && c===CENTER_COL) b.classList.add('center-block');
                else b.style.backgroundColor = BLOCK_COLORS[Math.floor(Math.random()*BLOCK_COLORS.length)];
                blockGrid.appendChild(b);
            }
        }
    }

    function startCollapseAnimation(){
        document.querySelectorAll('.splash-block').forEach(b=>{
            const d = Math.abs(b.dataset.row-CENTER_ROW) + Math.abs(b.dataset.col-CENTER_COL);
            setTimeout(()=>b.classList.add('collapse'), d*30);
        });
        setTimeout(()=>{
            splashScreen.style.display='none';
            gameContainer.style.opacity=1;
            document.body.style.overflow='auto';
        }, GRID_COLS*30+800);
    }

    // ÂàùÂßãÂåñÊ∏∏ÊàèÊ£ãÁõò
    function initGameBoard(){
        gameBoard = Array(ROWS).fill().map(()=>Array(COLS).fill(null));
        clearingRows=[];
        clearAnimationTime=0;
    }

    // ÁîüÊàê‰∏ã‰∏Ä‰∏™ÊñπÂùó
    function generateNextShape() {
        const i = Math.floor(Math.random() * SHAPES.length);
        nextShape = SHAPES[i];
        nextColor = COLORS[i];
    }

    // ÁªòÂà∂‰∏ã‰∏Ä‰∏™ÊñπÂùó
    function drawNextShape() {
        nextCtx.clearRect(0, 0, nextCanvas.width, nextCanvas.height);
        const size = 24;
        const w = nextShape[0].length;
        const h = nextShape.length;
        const ox = (nextCanvas.width - w * size) / 2;
        const oy = (nextCanvas.height - h * size) / 2;

        for (let r = 0; r < h; r++) {
            for (let c = 0; c < w; c++) {
                if (nextShape[r][c]) {
                    const x = ox + c * size;
                    const y = oy + r * size;
                    nextCtx.fillStyle = nextColor;
                    nextCtx.fillRect(x, y, size - 1, size - 1);
                    nextCtx.strokeStyle = '#fff';
                    nextCtx.strokeRect(x, y, size - 1, size - 1);
                }
            }
        }
    }

    // ÂàõÂª∫Êñ∞ÊñπÂùó
    function newShape(){
        currentShape = nextShape;
        currentColor = nextColor;
        currentX = Math.floor((COLS - currentShape[0].length) / 2);
        currentY = 0;
        generateNextShape();
        drawNextShape();
        if (collide(currentX, currentY, currentShape)) gameOver();
    }

    // Á¢∞ÊíûÊ£ÄÊµã
    function collide(x,y,s){
        for(let r=0;r<s.length;r++){
            for(let c=0;c<s[r].length;c++){
                if(s[r][c]){
                    const rx=x+c, ry=y+r;
                    if(rx<0||rx>=COLS||ry>=ROWS||(ry>=0&&gameBoard[ry][rx])) return true;
                }
            }
        }
        return false;
    }

    // ÁªòÂà∂Âçï‰∏™ÊñπÂùó
    function drawBlock(x,y,col,clear=false){
        const px=x*GAME_BLOCK_SIZE, py=y*GAME_BLOCK_SIZE, s=GAME_BLOCK_SIZE-1;
        ctx.save();
        if(clear){
            const p=clearAnimationTime/ANIM_DURATION;
            ctx.globalAlpha=1-p;
            ctx.translate(px+s/2,py+s/2);
            ctx.scale(1-p,1-p);
            ctx.rotate(p*30*Math.PI/180);
            ctx.translate(-px-s/2,-py-s/2);
        }
        ctx.fillStyle=col; 
        ctx.fillRect(px,py,s,s);
        ctx.strokeStyle='#fff'; 
        ctx.strokeRect(px,py,s,s);
        ctx.restore();
    }

    // ÁªòÂà∂Ê∏∏ÊàèÁïåÈù¢
    function drawGame(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle='#333';
        for(let i=0;i<=COLS;i++){
            ctx.beginPath(); 
            ctx.moveTo(i*GAME_BLOCK_SIZE,0); 
            ctx.lineTo(i*GAME_BLOCK_SIZE,canvas.height); 
            ctx.stroke();
        }
        for(let i=0;i<=ROWS;i++){
            ctx.beginPath(); 
            ctx.moveTo(0,i*GAME_BLOCK_SIZE); 
            ctx.lineTo(canvas.width,i*GAME_BLOCK_SIZE); 
            ctx.stroke();
        }
        for(let r=0;r<ROWS;r++){
            for(let c=0;c<COLS;c++){
                if(gameBoard[r][c]) drawBlock(c,r,gameBoard[r][c], clearingRows.includes(r));
            }
        }
        if(currentShape){
            for(let r=0;r<currentShape.length;r++){
                for(let c=0;c<currentShape[r].length;c++){
                    if(currentShape[r][c]) drawBlock(currentX+c, currentY+r, currentColor);
                }
            }
        }
    }

    // ÊóãËΩ¨ÊñπÂùó
    function rotate(){
        if(isPaused||isGameOver||clearingRows.length) return;
        const rs = currentShape[0].map((_,i)=>currentShape.map(row=>row[i]).reverse());
        if(!collide(currentX,currentY,rs)) currentShape=rs;
    }

    // ÁßªÂä®ÊñπÂùó
    function move(dx,dy){
        if(isPaused||isGameOver||clearingRows.length) return false;
        if(!collide(currentX+dx,currentY+dy,currentShape)){
            currentX+=dx; 
            currentY+=dy; 
            return true;
        }
        if(dy>0) fixShape();
        return false;
    }

    // Âõ∫ÂÆöÊñπÂùóÂà∞Ê£ãÁõò
    function fixShape(){
        for(let r=0;r<currentShape.length;r++){
            for(let c=0;c<currentShape[r].length;c++){
                if(currentShape[r][c]){
                    const rx=currentX+c, ry=currentY+r;
                    if(ry>=0) gameBoard[ry][rx]=currentColor;
                }
            }
        }
        checkLines();
    }

    // Ê£ÄÊü•Ê∂àË°å
    function checkLines(){
        const full=[];
        for(let r=ROWS-1;r>=0;r--){
            if(gameBoard[r].every(x=>x)) full.push(r);
        }
        if(full.length){
            clearingRows=full;
            clearAnimationTime=0;
        }else newShape();
    }

    // ÊâßË°åÊ∂àË°å
    function applyClear(){
        clearingRows.sort((a,b)=>b-a);
        clearingRows.forEach(r=>{
            gameBoard.splice(r,1); 
            gameBoard.unshift(Array(COLS).fill(null));
        });
        score += [0,100,300,500,800][clearingRows.length];
        scoreEl.textContent=score;
        clearingRows=[];
        newShape();
    }

    // ÊñπÂùó‰∏ãËêΩ
    function drop(){
        if(!isPaused&&!clearingRows.length) move(0,1);
    }

    // Ê∏∏ÊàèÁªìÊùü
    function gameOver(){
        isGameOver=true;
        clearInterval(gameInterval);
        gameOverText.style.display='block';
        pauseBtn.disabled=true;
    }

    // ÊöÇÂÅú/ÁªßÁª≠Ê∏∏Êàè
    function togglePause(){
        if(isGameOver) return;
        isPaused=!isPaused;
        if(isPaused){
            clearInterval(gameInterval);
            pauseMask.style.display='flex';
            pauseBtn.textContent=currentLang.continueText;
        }else{
            lastTime = performance.now();
            dropTimer = 0;
            gameInterval=setInterval(loop, 16);
            pauseMask.style.display='none';
            pauseBtn.textContent=currentLang.pause;
        }
    }

    // ÊÅ¢Â§çÊ∏∏ÊàèÔºàÂºπÁ™óÊåâÈíÆÔºâ
    function resumeGame() {
        if(isPaused && !isGameOver) {
            togglePause();
        }
    }

    // ÂõûÂà∞‰∏ªÈ°µ
    function goToHome() {
        // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
        isGameOver = false;
        isPaused = false;
        score = 0;
        scoreEl.textContent = score;
        
        // ÂÅúÊ≠¢Ê∏∏ÊàèÂæ™ÁéØ
        clearInterval(gameInterval);
        
        // ÈöêËóèÊ∏∏ÊàèÁïåÈù¢ÔºåÊòæÁ§∫ÂºÄÂú∫ÁïåÈù¢
        gameContainer.style.opacity = 0;
        splashScreen.style.display = 'flex';
        pauseMask.style.display = 'none';
        gameOverText.style.display = 'none';
        
        // ÈáçÁΩÆÊöÇÂÅúÊåâÈíÆÁä∂ÊÄÅ
        pauseBtn.disabled = true;
        pauseBtn.textContent = currentLang.pause;
        
        // ÈáçÊñ∞ÂàõÂª∫ÂºÄÂú∫ÁΩëÊ†º
        blockGrid.innerHTML = '';
        createSplashGrid();
    }

    // ÂºÄÂßãÊ∏∏Êàè
    function startGame(){
        initGameBoard();
        score=0; 
        scoreEl.textContent=score;
        isGameOver=false; 
        isPaused=false;
        gameOverText.style.display='none'; 
        pauseMask.style.display='none';
        clearInterval(gameInterval);
        pauseBtn.disabled=false; 
        pauseBtn.textContent=currentLang.pause;

        generateNextShape();
        newShape();
        drawNextShape();

        lastTime = performance.now();
        dropTimer = 0;
        gameInterval=setInterval(loop, 16);
    }

    // Ê∏∏Êàè‰∏ªÂæ™ÁéØ
    function loop(){
        if(isPaused || isGameOver) return;
        const now = performance.now();
        const dt = now - lastTime;
        lastTime = now;

        if(clearingRows.length){
            clearAnimationTime += dt;
            if(clearAnimationTime >= ANIM_DURATION){
                applyClear();
                clearAnimationTime = 0;
            }
        }else{
            dropTimer += dt;
            if(dropTimer >= DROP_SPEED){
                drop();
                dropTimer = 0;
            }
        }
        drawGame();
    }

    // ÊûÅÈÄü‰∏ãËêΩ
    function hardDrop() {
        if(isPaused||isGameOver||clearingRows.length) return;
        while(move(0,1)){}
        drawGame();
    }

    // ‰∫ã‰ª∂ÁõëÂê¨
    splashScreen.addEventListener('click', startCollapseAnimation);
    startBtn.addEventListener('click', startGame);
    pauseBtn.addEventListener('click', togglePause);
    langBtn.addEventListener('click', switchLanguage);
    resumeBtn.addEventListener('click', resumeGame);
    homeBtn.addEventListener('click', goToHome);

    // ÈîÆÁõò‰∫ã‰ª∂
    document.addEventListener('keydown',e=>{
        // ESCÈîÆÊöÇÂÅúÊ∏∏Êàè
        if(e.key === 'Escape') {
            if(!isPaused && !isGameOver) {
                togglePause();
            }
            return;
        }

        if(isPaused||isGameOver||clearingRows.length) return;
        switch(e.key){
            case 'ArrowLeft': 
                move(-1,0); 
                drawGame();
                break;
            case 'ArrowRight': 
                move(1,0); 
                drawGame();
                break;
            case 'ArrowDown': 
                move(0,1); 
                drawGame();
                break;
            case 'ArrowUp': 
                rotate(); 
                drawGame();
                break;
            case ' ': 
                hardDrop(); 
                break;
        }
    });

    // ÂàùÂßãÂåñ
    createSplashGrid();
    initGameBoard();
    generateNextShape();
    drawNextShape();
    drawGame();
</script>
</body>
</html>